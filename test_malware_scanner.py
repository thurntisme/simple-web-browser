#!/usr/bin/env python3
"""
Test script for the malware scanner functionality.
"""

import os
import tempfile
from malware_scanner import MalwareScanner

def test_malware_scanner():
    """Test the malware scanner with various file types"""
    
    print("üõ°Ô∏è Testing Malware Scanner")
    print("=" * 50)
    
    scanner = MalwareScanner()
    
    # Test 1: Clean text file
    print("\nüìÑ Test 1: Clean text file")
    with tempfile.NamedTemporaryFile(mode='w', suffix='.txt', delete=False) as f:
        f.write("This is a clean text file with no threats.")
        clean_file = f.name
    
    try:
        result = scanner.scan_file(clean_file)
        print(f"   File: {os.path.basename(clean_file)}")
        print(f"   Threat Level: {result['threat_level']}")
        print(f"   Threats Found: {len(result['threats_found'])}")
        print(f"   Scan Methods: {', '.join(result['scan_methods'])}")
    finally:
        os.unlink(clean_file)
    
    # Test 2: EICAR test file (harmless test virus)
    print("\nü¶† Test 2: EICAR test file")
    with tempfile.NamedTemporaryFile(mode='wb', suffix='.txt', delete=False) as f:
        f.write(b'X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*')
        eicar_file = f.name
    
    try:
        result = scanner.scan_file(eicar_file)
        print(f"   File: {os.path.basename(eicar_file)}")
        print(f"   Threat Level: {result['threat_level']}")
        print(f"   Threats Found: {len(result['threats_found'])}")
        if result['threats_found']:
            for threat in result['threats_found']:
                print(f"   - {threat['description']}")
    finally:
        os.unlink(eicar_file)
    
    # Test 3: Suspicious executable extension
    print("\n‚ö†Ô∏è Test 3: Suspicious executable file")
    with tempfile.NamedTemporaryFile(mode='w', suffix='.exe', delete=False) as f:
        f.write("This is not really an executable, just testing extension detection.")
        exe_file = f.name
    
    try:
        result = scanner.scan_file(exe_file)
        print(f"   File: {os.path.basename(exe_file)}")
        print(f"   Threat Level: {result['threat_level']}")
        print(f"   Threats Found: {len(result['threats_found'])}")
        if result['threats_found']:
            for threat in result['threats_found']:
                print(f"   - {threat['description']}")
    finally:
        os.unlink(exe_file)
    
    # Test 4: File with suspicious VBS content
    print("\nüîç Test 4: File with suspicious VBS pattern")
    with tempfile.NamedTemporaryFile(mode='wb', suffix='.vbs', delete=False) as f:
        f.write(b'Set objShell = CreateObject("WScript.Shell")\nobjShell.Run "cmd.exe"')
        vbs_file = f.name
    
    try:
        result = scanner.scan_file(vbs_file)
        print(f"   File: {os.path.basename(vbs_file)}")
        print(f"   Threat Level: {result['threat_level']}")
        print(f"   Threats Found: {len(result['threats_found'])}")
        if result['threats_found']:
            for threat in result['threats_found']:
                print(f"   - {threat['description']}")
    finally:
        os.unlink(vbs_file)
    
    print("\n‚úÖ Malware scanner tests completed!")
    print("\nRecommendations for production use:")
    print("- Add more malware signatures to the database")
    print("- Integrate with online threat intelligence APIs")
    print("- Add real-time scanning capabilities")
    print("- Implement quarantine functionality")
    print("- Add detailed logging and reporting")

if __name__ == "__main__":
    test_malware_scanner()